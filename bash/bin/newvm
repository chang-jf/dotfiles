#!/bin/bash
VM_HOST="127.0.0.1"
RANDOM_MAC=`/home/angus/.bin/random_mac2.sh`
RANDOM_HOSTNAME=`echo $RANDOM_MAC |awk -F ':' '{print "tmp"$4$5$6}'`
DEFAULT_TEMPLATE="base_w8"
DEFAULT_NETWORK="nat"
INSTANCE_VOL=$RANDOM_HOSTNAME

warn() {
    echo "$1" >&2
    echo ""
}

die() {
    warn "$1"
    exit 1
}
[ -v $1 ] && TEMPLATE_VOL=$1
[ -z $1 ] && TEMPLATE_VOL=$DEFAULT_TEMPLATE;echo "Instnace domain name is:"$INSTANCE_VOL

sudo virsh vol-create-as default $INSTANCE_VOL 50G --format qcow2 \
    --backing-vol `sudo virsh vol-key --pool default $TEMPLATE_VOL` --backing-vol-format qcow2
sudo virt-install -n $INSTANCE_VOL -r 4096 --disk vol=default/$INSTANCE_VOL,bus=virtio --noautoconsole --import
remote-viewer `sudo virsh domdisplay $INSTANCE_VOL`
